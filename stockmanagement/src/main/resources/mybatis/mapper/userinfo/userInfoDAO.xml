<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.estock.stockmanagement.dao.userinfo.UserInfoDAO">

    <resultMap type="UserInfoAuthorityAdapter" id="userAuthorities">
        <id property="id" column="id"/>
        <result property="userName" column="user_name"/>
        <result property="accountExpired" column="account_expired"/>
        <result property="accountLocked" column="account_locked"/>
        <result property="credentialsExpired" column="credentials_expired"/>
        <result property="enabled" column="enabled"/>
        <association property="authorities" resultMap="authority" javaType="list"/>
    </resultMap>

    <resultMap type="UserInfoAuthorityData" id="authority">
        <id property="id" column="authority_id"/>
        <result property="name" column="authority_name"/>
    </resultMap>
    
    <resultMap type="UserInfoAdapter" id="userAuthorities">
        <id property="id" column="id"/>
        <result property="userName" column="user_name"/>
        <result property="accountExpired" column="account_expired"/>
        <result property="accountLocked" column="account_locked"/>
        <result property="credentialsExpired" column="credentials_expired"/>
        <result property="enabled" column="enabled"/>
        <result property="address" column="address"/>
        <result property="dateBirth" column="date_birth"/>
        <result property="identifyInfoId" column="identify_info_id"/>
        <result property="phoneNumber" column="phone_number"/>
        <result property="othePhoneNumber" column="other_phone_number"/>
        <result property="resourceId" column="resource_id"/>
    </resultMap>
    
    <select id="loadUserAuthority" resultMap="loadUserByUserId">
        <![CDATA[
			SELECT
				 u.id
				, u.user_name
				, u."password"
				, u.account_expired
				, u.account_locked
				, u.credentials_expired
				, u.enabled
				, au."name" as "authority_name"
				, au."id" as "authority_id"
			FROM user_auth as u
			LEFT JOIN users_authorities as ua on u."id" = ua.user_id
			LEFT JOIN authority as au on au."id" = ua.authority_id
			WHERE user_name = #{userId};
	   ]]>
    </select>
    
    <select id="loadUserByUserId" resultMap="loadUserByUserId">
        <![CDATA[
			SELECT
				 u.id
				, u.user_name
				, u.account_expired
				, u.account_locked
				, u.credentials_expired
				, u.enabled
				, u.address
				, u.date_birth
				, u.full_name
				, u.gender
				, u.identify_info_id
				, u.phone_number
				, u.other_phone_number
				, u.resource_id
			FROM user_auth as u
			WHERE u.id = #{userId};
	   ]]>
    </select>
</mapper>