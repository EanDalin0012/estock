<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.api.stockmanagement.dao.userdetails.UserDetailsDAO">

    <resultMap type="UserAdapter" id="user">
        <id property="id" column="id"/>
        <result property="userName" column="user_name"/>
        <result property="password" column="password"/>
        <result property="accountExpired" column="account_expired"/>
        <result property="accountLocked" column="account_locked"/>
        <result property="credentialsExpired" column="credentials_expired"/>
        <result property="enabled" column="enabled"/>
        <association property="authorities" resultMap="authority" javaType="list"/>
    </resultMap>

    <resultMap type="AuthorityAdapter" id="authority">
        <id property="id" column="authority_id"/>
        <result property="name" column="authority_name"/>
    </resultMap>

    <select id="loadUserByUsername" resultMap="user">
        <![CDATA[
            SELECT
                us."id"
                 , us.user_name
                 , us."password"
                 , us.account_expired
                 , us.account_locked
                 , us.credentials_expired
                 , us.enabled
                 , au."id"	as "authority_id"
                 , au."name" as "authority_name"
            FROM "user" us
                     INNER JOIN users_authorities ua on us."id" = ua.user_id
                     INNER JOIN authority au on au."id" = ua.authority_id
            WHERE us.user_name = 'admin@gmail.com';
        ]]>
    </select>

</mapper>